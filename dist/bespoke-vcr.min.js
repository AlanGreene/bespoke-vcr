/*! bespoke-vcr v0.0.1-alpha-1 Â© 2013 Mark Dalgleish, Licensed MIT */
(function(e){var t=function(e,s){s.reporter=s.reporter||"console";var o=n()||[],u=s.recording||r(),a=typeof s.reporter=="string"?t.reporters[s.reporter]:s.reporter,f,l=!1,c=!1,h=function(){var e=document.createElement("div"),t="8px";return e.style.width=t,e.style.height=t,e.style.borderRadius=t,e.style.position="absolute",e.style.left="4px",e.style.bottom="4px",e.style.backgroundColor="transparent",document.body.appendChild(e),{red:function(){e.style.backgroundColor="red"},green:function(){e.style.backgroundColor="green"},clear:function(){e.style.backgroundColor="transparent"}}}(),p=function(){if(l)return v();e.slide(0),l=!0,c=!1,h.red(),a("Recording to local storage..."),f=(new Date).getTime(),u=[],o.push(u)},d=function(){l&&v();if(u.length===0)return;c=!0,h.green(),a("Playing the following recording:",u),e.slide(0),u.forEach(function(t){setTimeout(function(){t.command?e[t.command].apply(null,t.arguments||[]):(a("Playback complete"),c=!1,h.clear())},t.timeout)})},v=function(){l&&(u.push({timeout:(new Date).getTime()-f}),i(o),a("Successfully recorded the following to local storage:",u)),l=!1,c=!1,h.clear()};["next","prev","slide"].forEach(function(t){e.on(t,function(e){var n={command:t,timeout:(new Date).getTime()-f};t==="slide"&&(n.arguments=[e.index]),l&&u.push(n)&&i(o)})});var m=s.remote||function(e){window.addEventListener("keydown",function(t){var n=80,r=82,i=83;switch(t.which){case r:e.record();break;case i:e.stop();break;case n:e.play()}})},g={record:p,play:d,stop:v};m(g)},n=function(){var e=localStorage["bespoke-vcr"];return e?JSON.parse(e):[]},r=function(){var e=n();return e.length?e[e.length-1]:undefined},i=function(e){localStorage["bespoke-vcr"]=JSON.stringify(e)},s=function(){delete localStorage["bespoke-vcr"]};t.reporters={console:function(e,t){console.log("BESPOKE-VCR: "+e+"\n"+(t?JSON.stringify(t,null,2)+"\n":""))}},e.plugins.vcr=t,window.vcr={latest:function(){t.reporters.console("Latest recording:",r())},all:function(){t.reporters.console("All recordings:",n())},clear:s}})(bespoke);